import streamlit as st
import time # Importe se for usar a fun√ß√£o de sleep/wait

# --- Fun√ß√µes de A√ß√£o (A ser implementado no seu c√≥digo) ---

def cadastrar_sdr(nome_sdr):
    """
    Simula a l√≥gica de cadastro.
    Aqui voc√™ adicionaria o SDR √† sua base de dados (JSON, DB, etc.).
    """
    if nome_sdr:
        st.session_state.feedback_cadastro = f"SDR '{nome_sdr}' cadastrado com sucesso!"
        st.session_state.status_cadastro = "success"
        # Adicione aqui a l√≥gica real de persist√™ncia de dados
        time.sleep(1) # Simula o tempo de processamento
    else:
        st.session_state.feedback_cadastro = "O nome do SDR n√£o pode ser vazio."
        st.session_state.status_cadastro = "error"

def limpar_cadastro():
    """
    Fun√ß√£o de callback para limpar o campo de input ap√≥s o cadastro.
    Ao ser executada no callback (on_click), ela redefine a chave no 
    st.session_state antes do Streamlit renderizar o widget novamente.
    """
    # Use a chave que estava causando o erro no seu traceback
    if "new_sdr_name_key" in st.session_state:
        st.session_state.new_sdr_name_key = ""
    
    # Limpa a mensagem de feedback ap√≥s a limpeza do campo
    st.session_state.feedback_cadastro = ""
    st.session_state.status_cadastro = ""


# --- Fun√ß√£o de Renderiza√ß√£o (Onde voc√™ estava tendo o erro) ---

def render_cadastro():
    # 1. Inicializa o state (opcional, mas boa pr√°tica)
    if 'feedback_cadastro' not in st.session_state:
        st.session_state.feedback_cadastro = ""
    if 'status_cadastro' not in st.session_state:
        st.session_state.status_cadastro = ""

    st.subheader("üìù Cadastro SDR")

    # O widget de input - O valor digitado √© automaticamente armazenado em st.session_state.new_sdr_name_key
    nome_sdr = st.text_input(
        "Nome do Novo SDR",
        key="new_sdr_name_key",
        placeholder="Ex: Jo√£o Silva",
    )
    
    # Exibe feedback (sucesso/erro)
    if st.session_state.status_cadastro == "success":
        st.success(st.session_state.feedback_cadastro)
    elif st.session_state.status_cadastro == "error":
        st.error(st.session_state.feedback_cadastro)


    # Bot√£o de Cadastro
    # CR√çTICO: Use os callbacks 'on_click' para garantir a ordem correta de execu√ß√£o
    st.button(
        "Cadastrar",
        on_click=limpar_cadastro, 
        args=[], 
        # Esta fun√ß√£o √© executada ANTES da tela ser renderizada, 
        # redefinindo o valor da chave antes que o widget seja desenhado no pr√≥ximo rerun.
    )

    # Nota: Voc√™ deve chamar a fun√ß√£o 'cadastrar_sdr' no momento em que o 
    # bot√£o for clicado, mas a l√≥gica de limpeza DEVE ser separada no 'on_click'
    
    # Uma forma mais simples, sem on_click, mas mais direta, se voc√™ preferir:
    # if st.button("Cadastrar SDR"):
    #     cadastrar_sdr(st.session_state.new_sdr_name_key)
    #     limpar_cadastro() 
    #     st.rerun() # Necess√°rio para for√ßar a limpeza imediata
    # Essa forma acima √© mais intuitiva e menos propenso a erros de contexto.


# --- Fun√ß√£o Principal (Onde voc√™ chama render_cadastro) ---

def main_app():
    # ... Outras chamadas de fun√ß√µes ...
    render_cadastro()
    # ... Outras chamadas de fun√ß√µes ...

if __name__ == "__main__":
    main_app()